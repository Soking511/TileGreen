<header class="w-full z-40 overflow-hidden flex flex-col justify-between " role="banner"
    [ngClass]="{'bg-gradient-to-b from-[#a8a8a8] to-[#424242] h-screen': imagePath}">

    <!-- Background Image with Lazy Loading -->
    @if (imagePath) {
    <img [src]="imagePath" alt="Header Background" class="absolute inset-0 w-full h-screen object-cover" priority
        width="1920" height="1080">
    <div class="absolute inset-0 bg-gradient-to-b from-black/60 to-transparent"></div>
    }

    <!-- Content Container -->
    <div class="fixed w-screen z-40 flex flex-col ">
        <!-- Nav Section -->
        <nav class="flex flex-wrap items-center justify-between font-neue-haas py-2 xs:py-3 sm:py-4 md:py-5 w-full px-3 xs:px-4 sm:px-6 md:px-16"
            [class.bg-white]="isScrolled" [class.text-black]="isScrolled"
            [ngClass]="imagePath && !isScrolled ? 'text-white' : 'text-black'" aria-label="Main navigation">
            <div class="flex items-center gap-1 xs:gap-2 z-20">
                <a href="/home" [routerLink]="'/home'" aria-label="TileGreen Home Page"
                    class="focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 rounded-md">
                    <svg width="42" class="h-2 xs:h-7 sm:h-5 md:h-5" height="48" viewBox="0 0 52 48" fill="none"
                        class="cursor-pointer" xmlns="https://www.w3.org/2000/svg" aria-hidden="true">
                        <title>TileGreen Logo</title>
                        <g clip-path="url(#clip0_118_1154)">
                            <path
                                d="M51.9749 40.6678C51.9749 44.6898 48.6596 47.9807 44.6076 47.9807H36.8315C32.7795 47.9807 29.4642 44.6898 29.4642 40.6678V31.2255C29.4642 27.2035 32.7795 23.9127 36.8315 23.9127H48.7004L47.0638 29.3161H36.9137C35.8084 29.3161 34.867 30.2101 34.867 31.3477V40.5868C34.867 41.6839 35.8084 42.6184 36.9137 42.6184H44.4851C45.6313 42.6184 46.5319 41.6839 46.5319 40.5868V39.3195H41.129L39.4918 33.916H51.9749V40.6678Z"
                                [attr.fill]="imagePath && !isScrolled ? 'white' : '#0F8C22'" />
                            <path
                                d="M11.0205 15.8993V22.2203H20.9287V25.3571V43.6314V47.9801H27.6705V43.6314V22.2203H49.1563L51.0203 15.8993H11.0205Z"
                                [attr.fill]="imagePath && !isScrolled ? 'white' : '#0F8C22'" />
                            <path
                                d="M51.9749 0.0199661H45.6068H0.025116V0.61155V6.341V41.659V47.9801H6.39323H11.0205V41.659H6.39323V6.341H45.6068V10.934H51.9749V6.341V0.0199661Z"
                                [attr.fill]="imagePath && !isScrolled ? 'white' : '#021F59'" />
                        </g>
                        <defs>
                            <clipPath id="clip0_118_1154">
                                <rect width="52" height="48" fill="white" />
                            </clipPath>
                        </defs>
                    </svg>
                </a>
            </div>

            <!-- Mobile Menu Button -->
            <button
                class="md:hidden flex items-center justify-center z-20 p-1.5 xs:p-2 w-8 h-8 xs:w-10 xs:h-10 rounded-full transition-all touch-manipulation focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
                [ngClass]="isScrolled ? 'bg-gray-100 hover:bg-gray-200' : 'bg-blue-600/20 hover:bg-blue-600/30 backdrop-blur-sm'"
                (click)="toggleMobileMenu()" aria-label="Toggle navigation menu" [attr.aria-expanded]="isMobileMenuOpen"
                aria-controls="mobile-menu">
                <svg xmlns="https://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h12" />
                </svg>
            </button>

            <!-- Mobile Menu -->
            <div id="mobile-menu"
                class="md:hidden fixed inset-0 z-50 transform transition-all duration-300 ease-in-out overflow-hidden"
                [ngClass]="isMobileMenuOpen ? 'opacity-100 visible' : 'opacity-0 invisible'"
                [ngStyle]="{'transition-delay': isMobileMenuOpen ? '0s' : '0.3s'}" role="dialog" aria-modal="true"
                aria-label="Mobile navigation menu">
                <!-- Backdrop with blur - click or keyboard escape to close -->
                <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" (click)="toggleMobileMenu()"
                    (keydown.escape)="toggleMobileMenu()" [ngClass]="isMobileMenuOpen ? 'opacity-100' : 'opacity-0'"
                    style="transition: opacity 0.3s ease-in-out;"></div>

                <!-- Mobile menu content -->
                <div class="flex flex-col h-full w-full max-w-sm ml-auto transform transition-transform duration-300 ease-in-out bg-gradient-to-b from-slate-900 to-blue-900/90 backdrop-blur-md"
                    [ngClass]="isMobileMenuOpen ? 'translate-x-0' : 'translate-x-full'">

                    <!-- Header with logo and close button -->
                    <div class="flex justify-between items-center px-6 py-4 border-b border-white/10">
                        <div class="flex items-center gap-2">
                            <a href="/home" [routerLink]="'/home'" aria-label="TileGreen Home Page"
                                class="focus:outline-none focus:ring-2 focus:ring-white rounded-md">
                                <svg width="40" height="38" viewBox="0 0 52 48" fill="none" class="cursor-pointer"
                                    xmlns="https://www.w3.org/2000/svg" aria-hidden="true">
                                    <g clip-path="url(#clip0_mobile_logo)">
                                        <path
                                            d="M51.9749 40.6678C51.9749 44.6898 48.6596 47.9807 44.6076 47.9807H36.8315C32.7795 47.9807 29.4642 44.6898 29.4642 40.6678V31.2255C29.4642 27.2035 32.7795 23.9127 36.8315 23.9127H48.7004L47.0638 29.3161H36.9137C35.8084 29.3161 34.867 30.2101 34.867 31.3477V40.5868C34.867 41.6839 35.8084 42.6184 36.9137 42.6184H44.4851C45.6313 42.6184 46.5319 41.6839 46.5319 40.5868V39.3195H41.129L39.4918 33.916H51.9749V40.6678Z"
                                            fill="white" />
                                        <path
                                            d="M11.0205 15.8993V22.2203H20.9287V25.3571V43.6314V47.9801H27.6705V43.6314V22.2203H49.1563L51.0203 15.8993H11.0205Z"
                                            fill="white" />
                                        <path
                                            d="M51.9749 0.0199661H45.6068H0.025116V0.61155V6.341V41.659V47.9801H6.39323H11.0205V41.659H6.39323V6.341H45.6068V10.934H51.9749V6.341V0.0199661Z"
                                            fill="white" />
                                    </g>
                                    <defs>
                                        <clipPath id="clip0_mobile_logo">
                                            <rect width="52" height="48" fill="white" />
                                        </clipPath>
                                    </defs>
                                </svg>
                            </a>
                            <span class="text-white font-medium text-lg">TileGreen</span>
                        </div>

                        <button
                            class="p-2 touch-manipulation rounded-full hover:bg-white/10 active:bg-white/20 transition-colors focus:outline-none focus:ring-2 focus:ring-white"
                            [ngClass]="'text-white'" (click)="toggleMobileMenu()" (keydown.escape)="toggleMobileMenu()"
                            aria-label="Close menu">
                            <svg xmlns="https://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>

                    <!-- Navigation items with improved keyboard navigation -->
                    <nav class="overflow-y-auto flex-1 py-6" aria-label="Mobile navigation">
                        <ul class="flex flex-col space-y-1 px-4" role="menu">
                            @for (item of navbarItems; track item) {
                            <li class="w-full" role="menuitem">
                                <a [routerLink]="item.link" routerLinkActive="mobile-active-link"
                                    [routerLinkActiveOptions]="{exact: item.link === '/home'}"
                                    (click)="toggleMobileMenu()"
                                    class="mobile-menu-item flex items-center w-full py-4 px-4 rounded-lg touch-manipulation text-white text-tile-regular tracking-wide text-lg transition-all focus:outline-none focus:ring-2 focus:ring-white/50">
                                    {{item.name}}
                                </a>
                            </li>
                            }
                        </ul>
                    </nav>

                    <!-- Bottom section with contact button -->
                    <div class="px-6 pb-8 pt-4 border-t border-white/10">
                        <button (click)="openContactPopup($event)"
                            class="z-50 font-tile-regular w-full flex justify-center contact-button bg-blue-600/40 hover:bg-blue-500/60 active:bg-blue-500/80 transition-all duration-200 border border-blue-400/50 rounded-full py-4 px-8 text-white font-medium tracking-wide focus:outline-none focus:ring-2 focus:ring-blue-400">
                            Contact Us
                        </button>
                    </div>
                </div>
            </div>

            <!-- Desktop Navigation -->
            <div class="hidden md:flex md:items-center md:justify-between md:flex-grow">
                <!-- Navigation Links - Centered -->
                <div class="flex-grow flex justify-center">
                    <ul class="flex flex-wrap justify-center space-x-4 lg:space-x-6 xl:space-x-8 text-sm lg:text-base"
                        role="menubar">
                        @for (item of navbarItems; track item) {
                        <li role="none">
                            <a [routerLink]="item.link" routerLinkActive="active-link"
                                [routerLinkActiveOptions]="{exact: item.link === '/home'}"
                                class="lg:text-xl nav-link hover:text-gray-300 py-1.5 px-1 tracking-wide transition-all duration-200 relative group text-tile-regular focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-md "
                                [ngClass]="imagePath && !isScrolled ? 'text-white focus:ring-white' : 'text-black focus:ring-blue-500'"
                                role="menuitem">
                                {{item.name}}

                            </a>
                        </li>
                        }
                    </ul>
                </div>

                <!-- Contact Us Button -->
                <div class="ml-4">
                    <button (click)="openContactPopup($event)"
                        class="cursor-pointer hover:opacity-100 opacity-80 contact-button relative border rounded-full px-4 lg:px-5 py-1 lg:py-2 whitespace-nowrap text-sm lg:text-base text-tile-regular tracking-wide focus:outline-none focus:ring-2"
                        [ngClass]="imagePath && !isScrolled ? 'border-white text-white focus:ring-white' : 'border-black text-black focus:ring-blue-500'"
                        aria-label="Open contact form">
                        <span class="relative z-10">Contact Us</span>
                    </button>
                </div>
            </div>
        </nav>
    </div>

    @if (imagePath) {
    <!-- Bottom Section with divider and heading - Fully centered -->
    <div class="relative w-full z-10 flex flex-col items-center justify-center h-full mt-20 ">
        <!-- Main Heading - Centered both horizontally and vertically -->
        <span #animateElement [@fadeInUp]="true"
            class="max-w-3xl text-white text-4xl md:text-7xl text-tile-regular text-center" [innerHTML]="headTitle1">
        </span>

        <!-- Bottom content - Also centered -->
        <div #animateElement [@fadeInUp]="true"
            class="container mx-auto px-4 sm:px-6 md:px-8 py-5 sm:py-6 md:py-8 mt-8 ">
            <div class="flex flex-col items-center justify-center text-center">
                <p class="text-base sm:text-lg md:text-xl lg:text-2xl text-white max-w-3xl mx-auto"
                    aria-describedby="main-heading">
                    <span class="text-tile-inter">
                        {{description1}}
                    </span>
                    <br>
                    <span>
                        {{description2}}
                    </span>
                </p>

                <div class="mt-4" *ngIf="button1Text">
                    <a [routerLink]="navigateTo"
                        class="p-1 sm:p-1.5 cursor-pointer bg-[#0460d9]/40 backdrop-blur-sm group relative inline-flex items-center rounded-[40px] sm:rounded-[50px] overflow-hidden focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2"
                        aria-label=button1Text>
                        <span
                            class="px-3 sm:px-4 md:px-5 py-1.5 sm:py-2 text-lg sm:text-xl md:text-2xl text-tile-regular text-white z-10 transition-colors duration-900 whitespace-nowrap group-hover:text-blue-700">
                            {{button1Text}}
                        </span>
                        <span class="relative">
                            <span class="absolute right-0 top-0 w-10 h-10 sm:w-12 sm:h-12 md:w-14 md:h-14 bg-white rounded-full transition-all duration-700 ease-out transform origin-center
                                  group-hover:scale-[20] group-hover:bg-white group-hover:rounded-none"></span>

                            <span
                                class="flex items-center justify-center w-10 h-10 sm:w-12 sm:h-12 md:w-14 md:h-14 relative z-10">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none"
                                    xmlns="https://www.w3.org/2000/svg" class="w-4 h-4 sm:w-5 sm:h-5 md:w-6 md:h-6"
                                    aria-hidden="true">
                                    <path d="M13.5 19L21.5 12L13.5 5M21.5 12H2.5" stroke="blue" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                            </span>
                        </span>
                    </a>
                </div>
            </div>
        </div>
    </div>
    }
</header>
<!-- Contact popup is now managed globally in app component -->